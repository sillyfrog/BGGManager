<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width; initial-scale=1.0;" />
    <title>Groups</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="/static/style.css" />
    <script>
      function updateGroups() {
        fetch('/getgroups')
        .then(function (response) {
            return response.json();
        })
        .then(function (response) {
          var tbody = document.getElementById("groups");
          while (tbody.rows.length > 0) tbody.deleteRow(-1);
          response.push({'id':'new', 'name':''})
          for (group of response) {
            row = tbody.insertRow();
            var cell = row.insertCell();
            cell.innerText = group.id;

            cell = row.insertCell();
            input = document.createElement("input");
            input.name = "name";
            input.value = group.name;
            cell.appendChild(input);
          }
        });
      }

      function saveGroups() {
        var tbody = document.getElementById("groups");
        var b = document.getElementById("savegroups");
        b.innerHTML = "Saving... ";
        b.classList.remove('btn-primary');
        b.classList.remove('btn-success');
        b.classList.remove('btn-danger');
        b.classList.add('btn-info');
        var groups = [];
        for (row of tbody.rows) {
          var jqrow = $(row);
          var id = jqrow.find("td")[0].innerText;
          var name = jqrow.find("input[name=name]")[0].value;
          groups.push({"id":id, "name":name})
        };
        fetch('/updategroups', {
        headers: {
            'Content-Type': 'application/json'
        },
        method: "POST",
        body: JSON.stringify(groups)
    })
        .then(function (response) {
            return response.text();
        })
        .then(function (response) {
          updateGroups();
          b.innerHTML = "Saved!";
          b.classList.remove('btn-primary');
          b.classList.remove('btn-info');
          b.classList.remove('btn-danger');
          b.classList.add('btn-success');
        });
      }
    </script>
    <script type="text/javascript" src="/static/game.js"></script>
</head>
<body onLoad="updateGroups();">
  <div class="row flex-nowrap justify-content-between align-items-center">
    <div class="col-4 pt-1">
      <a class="text-muted" href="/">All Games</a>
    </div>
    <div class="col-4 text-center">
      <h1>Games Groups</h1>
    </div>
    <div class="col-4 d-flex justify-content-end align-items-center">
    </div>
  </div>
  <table class="table table-sm ">
    <thead>
      <th>ID</th>
      <th>Group Name</th>
    </thead>
    <tbody id="groups">
    </tbody>
  </table>
  <button id="savegroups" class="btn btn-primary btn-lg btn-block" onClick="saveGroups();">Update Groups</button>
  <p>&nbsp;</p>
</body>
</html>



